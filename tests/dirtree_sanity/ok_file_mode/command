# It appears file(1) correctly identifies all truly executable files
# and lists "executable" in the description of them. Additionally,
# we have a couple of files that we whitelist based on their file
# extension without awaiting the verdict of file(1).

TMPFILE=`mktemp` || exit 1

git ls-files -oc --exclude-standard | \
    egrep -v '\.(pl|py|sh)$' | \
    while read f ; do
        if test -x "$f" && ! file -b "$f" | grep -iq executable ; then
            echo "Shouldn't be executable: $f" >> $TMPFILE
        fi
    done

if [ -s $TMPFILE ] ; then
    cat $TMPFILE >&2
    rm $TMPFILE
    exit 1
else
    rm $TMPFILE
fi
